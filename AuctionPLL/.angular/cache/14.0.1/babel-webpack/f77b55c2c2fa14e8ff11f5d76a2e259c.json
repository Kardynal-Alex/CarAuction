{"ast":null,"code":"import { ErrorMessages } from 'src/app/common/constants/error-messages';\nimport { map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"ngx-toastr\";\nimport * as i2 from \"src/app/services/lot.service\";\nimport * as i3 from \"src/app/common/confirmation-dialog/confirmation-dialog.service\";\nimport * as i4 from \"src/app/services/auth.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"../../../../common/empty-view/empty-view.component\";\nimport * as i7 from \"../../../../common/tooltip/tooltip.directive\";\nimport * as i8 from \"../../../../common/directives/bold.directive\";\nimport * as i9 from \"@angular/common\";\n\nfunction UserLotsComponent_div_0_div_1_ng_template_17_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\");\n    i0.ɵɵtext(2, \"Close Bid\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\");\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"currency\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const lot_r4 = i0.ɵɵnextContext(2).$implicit;\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"Start price \", i0.ɵɵpipeBind1(5, 2, lot_r4.startPrice), \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Current Bid \", i0.ɵɵpipeBind1(8, 4, lot_r4.currentPrice), \"\");\n  }\n}\n\nfunction UserLotsComponent_div_0_div_1_ng_template_17_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\");\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"currency\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const lot_r4 = i0.ɵɵnextContext(2).$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Sold for \", i0.ɵɵpipeBind1(3, 1, lot_r4.currentPrice), \"\");\n  }\n}\n\nfunction UserLotsComponent_div_0_div_1_ng_template_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtemplate(0, UserLotsComponent_div_0_div_1_ng_template_17_div_0_Template, 9, 6, \"div\", 19);\n    i0.ɵɵtemplate(1, UserLotsComponent_div_0_div_1_ng_template_17_div_1_Template, 4, 3, \"div\", 19);\n  }\n\n  if (rf & 2) {\n    const lot_r4 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵproperty(\"ngIf\", !lot_r4.isSold);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", lot_r4.isSold);\n  }\n}\n\nfunction UserLotsComponent_div_0_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 4);\n    i0.ɵɵelement(2, \"div\", 5)(3, \"img\", 6);\n    i0.ɵɵelementStart(4, \"div\", 7)(5, \"div\", 8);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 9);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"div\", 10)(10, \"button\", 11);\n    i0.ɵɵelement(11, \"i\", 12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function UserLotsComponent_div_0_div_1_Template_button_click_12_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r13);\n      const lot_r4 = restoredCtx.$implicit;\n      const ctx_r12 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r12.deleteLot(lot_r4.id));\n    });\n    i0.ɵɵelement(13, \"i\", 14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"div\", 15)(15, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function UserLotsComponent_div_0_div_1_Template_button_click_15_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r13);\n      const lot_r4 = restoredCtx.$implicit;\n      const ctx_r14 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r14.endBid(lot_r4));\n    });\n    i0.ɵɵelement(16, \"i\", 17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(17, UserLotsComponent_div_0_div_1_ng_template_17_Template, 2, 2, \"ng-template\", null, 18, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const lot_r4 = ctx.$implicit;\n\n    const _r5 = i0.ɵɵreference(18);\n\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"id\", \"timer-\", lot_r4.id, \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", ctx_r3.createImgPath(lot_r4.image), i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(lot_r4.nameLot);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(lot_r4.description);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"routerLink\", \"/lotform/updatelot/\", lot_r4.id, \"\");\n    i0.ɵɵproperty(\"disabled\", lot_r4.isSold);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"disbled\", lot_r4.isSold);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"contentTemplate\", _r5);\n  }\n}\n\nfunction UserLotsComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2);\n    i0.ɵɵtemplate(1, UserLotsComponent_div_0_div_1_Template, 19, 8, \"div\", 3);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.lots);\n  }\n}\n\nfunction UserLotsComponent_ng_template_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-empty-view\", 20);\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"text\", ctx_r2.emptyText);\n  }\n}\n\nexport let UserLotsComponent = /*#__PURE__*/(() => {\n  class UserLotsComponent {\n    constructor(toastrService, lotService, confirmationDialogService, authService) {\n      this.toastrService = toastrService;\n      this.lotService = lotService;\n      this.confirmationDialogService = confirmationDialogService;\n      this.authService = authService;\n      this.emptyText = 'List is empty =)';\n      this.str = {};\n    }\n\n    getUserId() {\n      return this.authService.getUserIdFromToken();\n    }\n\n    init() {\n      const userId = this.getUserId();\n      this.lotService.getLotsByUserId(userId).pipe(map(lots => lots.filter(lot => !lot?.isSold))).subscribe(response => {\n        this.lots = response;\n\n        for (let lot of response) {\n          this.initTimer(lot.id, lot.startDateTime);\n        }\n      });\n    }\n\n    ngOnInit() {\n      this.init();\n    }\n\n    ngOnDestroy() {\n      for (let lot of this.lots) {\n        clearInterval(this.str[lot.id]);\n      }\n    }\n\n    deleteLot(id) {\n      this.confirmationDialogService.confirm('Please confirm', 'Do you really want to ... ?').then(confirmed => {\n        if (confirmed) {\n          this.lotService.deleteLotById(id).subscribe(() => {\n            this.lots = this.lots.filter(x => x.id != id);\n            clearInterval(this.str[id]);\n            this.toastrService.success('Lot is deleted!');\n          }, () => {\n            this.toastrService.error(ErrorMessages.SomethingWentWrong, ErrorMessages.TryAgain);\n          });\n        }\n      }).catch();\n    }\n\n    endBid(lotEnd) {\n      this.confirmationDialogService.confirm('Please confirm', 'Do you really want to ... ?').then(confirmed => {\n        if (confirmed) {\n          lotEnd.isSold = true;\n          this.lotService.updateLot(lotEnd).subscribe(() => {\n            lotEnd.isSold = true;\n            clearInterval(this.str[lotEnd.id]);\n            document.getElementById('timer-' + lotEnd.id).innerHTML = \"Expired\";\n            this.toastrService.success('Lot is closed!');\n          }, () => {\n            this.toastrService.error(ErrorMessages.SomethingWentWrong, ErrorMessages.TryAgain);\n          });\n        }\n      }).catch();\n    }\n\n    createImgPath(serverPath) {\n      return this.lotService.createImgPath(serverPath);\n    }\n\n    initTimer(id, date) {\n      var dead = new Date(date);\n      dead.setDate(dead.getDate() + 15);\n      var deadline = new Date(dead).getTime(); //deadline=new Date(\"Jul 2, 2021 09:44:00\").getTime();\n\n      this.str[id] = setInterval(() => {\n        var now = new Date().getTime();\n        var t = deadline - now;\n        var days = Math.floor(t / (1000 * 60 * 60 * 24));\n        var hours = Math.floor(t % (1000 * 60 * 60 * 24) / (1000 * 60 * 60));\n        var minutes = Math.floor(t % (1000 * 60 * 60) / (1000 * 60));\n        var seconds = Math.floor(t % (1000 * 60) / 1000);\n        document.getElementById('timer-' + id).innerHTML = days + \"d \" + hours + \"h \" + minutes + \"m \" + seconds + \"s \";\n\n        if (t < 0) {\n          clearInterval(this.str[id]);\n          this.checkLotIfTimerIsExpired(id);\n          return;\n        }\n      }, 1000);\n    }\n\n    checkLotIfTimerIsExpired(id) {\n      var index = this.lots.findIndex(x => x.id == id);\n      var lot = this.lots[index];\n\n      if (parseFloat(lot?.startPrice.toString()) < parseFloat(lot?.currentPrice.toString())) {\n        this.lots = this.lots.filter(x => x.id != id);\n        return;\n      } else if (parseFloat(lot?.startPrice.toString()) === parseFloat(lot?.currentPrice.toString())) {\n        this.initTimer(lot.id, lot.startDateTime);\n        return;\n      }\n    }\n\n  }\n\n  UserLotsComponent.ɵfac = function UserLotsComponent_Factory(t) {\n    return new (t || UserLotsComponent)(i0.ɵɵdirectiveInject(i1.ToastrService), i0.ɵɵdirectiveInject(i2.LotService), i0.ɵɵdirectiveInject(i3.ConfirmationDialogService), i0.ɵɵdirectiveInject(i4.AuthService));\n  };\n\n  UserLotsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: UserLotsComponent,\n    selectors: [[\"app-user-lots\"]],\n    decls: 3,\n    vars: 2,\n    consts: [[\"class\", \"lots\", 4, \"ngIf\", \"ngIfElse\"], [\"empty\", \"\"], [1, \"lots\"], [4, \"ngFor\", \"ngForOf\"], [1, \"card\"], [1, \"timer\", 3, \"id\"], [\"alt\", \"profile picture\", 3, \"src\"], [1, \"main-block\"], [\"bold\", \"\", 1, \"header\"], [1, \"title\"], [1, \"row\"], [1, \"btn\", 3, \"routerLink\", \"disabled\"], [\"awesomeTooltip\", \"Edit lot\", 1, \"fa\", \"fa-edit\"], [1, \"btn\", 3, \"click\"], [\"awesomeTooltip\", \"Delete lot\", 1, \"fa\", \"fa-trash\"], [1, \"has-tooltip\"], [1, \"btn\", 3, \"disbled\", \"click\"], [\"awesomeTooltip\", \"\", 1, \"fa\", \"fa-close\", 3, \"contentTemplate\"], [\"tooltipTemplate\", \"\"], [4, \"ngIf\"], [3, \"text\"]],\n    template: function UserLotsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, UserLotsComponent_div_0_Template, 2, 1, \"div\", 0);\n        i0.ɵɵtemplate(1, UserLotsComponent_ng_template_1_Template, 1, 1, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n      }\n\n      if (rf & 2) {\n        const _r1 = i0.ɵɵreference(2);\n\n        i0.ɵɵproperty(\"ngIf\", !!(ctx.lots == null ? null : ctx.lots.length))(\"ngIfElse\", _r1);\n      }\n    },\n    dependencies: [i5.RouterLink, i6.EmptyViewComponent, i7.AwesomeTooltipDirective, i8.BoldDirective, i9.NgForOf, i9.NgIf, i9.CurrencyPipe],\n    styles: [\"[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]{margin:100px auto;width:60%}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{box-shadow:0 4px 8px #0003;max-width:300px;text-align:center;width:25%;float:left;border-radius:20px;height:auto;max-height:500px;margin:12px 15px}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .timer[_ngcontent-%COMP%]{border-radius:20px 20px 0 0;background-color:#000;color:#fff;opacity:.7;padding:5px}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .timer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{line-height:10px}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;max-height:200px;min-height:200px}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .main-block[_ngcontent-%COMP%]{padding:4px;height:100px}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .main-block[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{position:relative;font-size:20px;align-items:center;color:#000;font-size:15px}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .main-block[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{font-size:18px}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{margin:0 auto;display:flex;flex-direction:row}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{transform:scale(1.2)}[_nghost-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;font-size:22px;color:#000}\"]\n  });\n  return UserLotsComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}