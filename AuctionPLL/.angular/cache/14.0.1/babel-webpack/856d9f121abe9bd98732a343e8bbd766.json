{"ast":null,"code":"import { Guid } from 'guid-typescript';\nimport { SortMode } from 'src/app/common/sort-mode';\nimport { ErrorMessages } from 'src/app/common/constants/error-messages';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"ngx-toastr\";\nimport * as i2 from \"src/app/services/lot.service\";\nimport * as i3 from \"src/app/services/favorite.service\";\nimport * as i4 from \"src/app/services/auth.service\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/router\";\nimport * as i7 from \"../../../common/mat-spinner/mat-spinner.component\";\nimport * as i8 from \"../../../common/directives/bold.directive\";\nimport * as i9 from \"@angular/material/menu\";\nimport * as i10 from \"src/app/pipes/sort.pipe\";\n\nfunction ShowLotsComponent_app_mat_spinner_34_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-mat-spinner\", 10);\n  }\n\n  if (rf & 2) {\n    i0.ɵɵproperty(\"diameter\", 500)(\"strokeWidth\", 50);\n  }\n}\n\nfunction ShowLotsComponent_div_35_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"div\", 13);\n    i0.ɵɵelement(2, \"p\", 14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"img\", 15);\n    i0.ɵɵelementStart(4, \"div\", 16)(5, \"a\", 17);\n    i0.ɵɵlistener(\"click\", function ShowLotsComponent_div_35_div_1_Template_a_click_5_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const lot_r5 = i0.ɵɵnextContext().$implicit;\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.changeStar(lot_r5.id));\n    });\n    i0.ɵɵtext(6, \"\\u2605\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 18)(8, \"p\", 19);\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"div\", 20);\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"button\", 21);\n    i0.ɵɵtext(13);\n    i0.ɵɵpipe(14, \"currency\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const lot_r5 = i0.ɵɵnextContext().$implicit;\n    const ctx_r6 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"id\", \"timer-\", lot_r5.id, \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", ctx_r6.createImgPath(lot_r5.image), i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"id\", \"star-\", lot_r5.id, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(lot_r5.nameLot);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(lot_r5.description);\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate1(\"routerLink\", \"/bid/lot/\", lot_r5.id, \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"Bid \", i0.ɵɵpipeBind1(14, 7, lot_r5.currentPrice), \"\");\n  }\n}\n\nfunction ShowLotsComponent_div_35_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, ShowLotsComponent_div_35_div_1_Template, 15, 9, \"div\", 11);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const lot_r5 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !lot_r5.isSold);\n  }\n}\n\nexport let ShowLotsComponent = /*#__PURE__*/(() => {\n  class ShowLotsComponent {\n    constructor(toastrService, lotService, favoriteService, authService) {\n      this.toastrService = toastrService;\n      this.lotService = lotService;\n      this.favoriteService = favoriteService;\n      this.authService = authService;\n      this.str = {};\n      this.userId = '';\n      this.isAuth = false;\n    }\n\n    get SortViewMode() {\n      return SortMode;\n    }\n\n    ngOnInit() {\n      this.sortField = '';\n      this.sortMode = null;\n      this.isAuth = this.authService.isAuthenticated();\n\n      if (this.isAuth) {\n        this.userId = this.authService.getUserIdFromToken();\n      }\n\n      this.getLots();\n    }\n\n    markStars() {\n      this.favoriteService.getUserFavorite(this.userId).subscribe(response => {\n        this.favorites = response;\n        setTimeout(() => {\n          for (let favorite of response) {\n            var x = document.getElementById(\"star-\" + favorite.lotId);\n            if (x != null) x.className = \"star\";\n          }\n        }, 500);\n      });\n    }\n\n    getLots() {\n      setTimeout(() => this.lotService.getAllLots().subscribe(res => {\n        this.lots = res;\n\n        for (let lot of res) {\n          this.initTimer(lot.id, lot.startDateTime);\n\n          if (this.isAuth) {\n            this.markStars();\n          }\n        }\n      }), 1000);\n    }\n\n    sortingData(sortmode, sortfield) {\n      this.sortMode = sortmode;\n      this.sortField = sortfield;\n    }\n\n    changeStar(lotId) {\n      document.getElementById('star-' + lotId).className == 'unstar' ? this.addToFavorite(lotId) : this.removeFromFavorite(lotId);\n    }\n\n    addToFavorite(lotId) {\n      if (this.isAuth) {\n        const favorite = {\n          id: Guid.create().toString(),\n          userId: this.userId,\n          lotId: lotId\n        };\n        this.favoriteService.addFavorite(favorite).subscribe(_ => {\n          document.getElementById('star-' + lotId).className = 'star';\n          this.favorites.push(favorite);\n        }, _ => {\n          this.toastrService.info(ErrorMessages.Unauthorized);\n        });\n      } else {\n        this.toastrService.info(ErrorMessages.Unauthorized);\n      }\n    }\n\n    removeFromFavorite(lotId) {\n      const index = this.favorites.findIndex(x => x.lotId == lotId);\n      const favoriteId = this.favorites[index].id;\n      this.favoriteService.deleteFavoriteById(favoriteId).subscribe(_ => {\n        this.favorites = this.favorites.filter(x => x.id != favoriteId);\n        document.getElementById('star-' + lotId).className = 'unstar';\n      });\n    }\n\n    createImgPath(serverPath) {\n      return this.lotService.createImgPath(serverPath);\n    }\n\n    checkLotIfTimerIsExpired(id) {\n      var index = this.lots.findIndex(x => x.id == id);\n      var lot = this.lots[index];\n\n      if (lot.startPrice < lot.currentPrice) {\n        lot.isSold = true;\n        this.lotService.updateLotAfterClosing(lot).subscribe(() => {\n          this.lots = this.lots.filter(x => x.id != id);\n        });\n        return;\n      } else if (lot.startPrice === lot.currentPrice) {\n        this.lotService.updateOnlyDateLot(lot).subscribe(() => {\n          document.getElementById('timer-' + id).innerHTML = 'Expired';\n          this.lots[index].startDateTime = new Date(Date.now());\n        });\n        this.initTimer(lot.id, this.lots[index].startDateTime);\n        return;\n      }\n    }\n\n    initTimer(id, date) {\n      var dead = new Date(date);\n      dead.setDate(dead.getDate() + 15);\n      var deadline = new Date(dead).getTime(); //deadline=new Date(\"Jul 31, 2021 12:30:00\").getTime();\n\n      this.str[id] = setInterval(() => {\n        var now = new Date().getTime();\n        var t = deadline - now;\n        var days = Math.floor(t / (1000 * 60 * 60 * 24));\n        var hours = Math.floor(t % (1000 * 60 * 60 * 24) / (1000 * 60 * 60));\n        var minutes = Math.floor(t % (1000 * 60 * 60) / (1000 * 60));\n        var seconds = Math.floor(t % (1000 * 60) / 1000);\n        if (document.getElementById('timer-' + id) != null && t >= 0) document.getElementById('timer-' + id).innerHTML = days + 'd ' + hours + 'h ' + minutes + 'm ' + seconds + 's ';\n\n        if (t < 0) {\n          clearInterval(this.str[id]);\n          this.checkLotIfTimerIsExpired(id);\n          return;\n        }\n      }, 1000);\n    }\n\n  }\n\n  ShowLotsComponent.ɵfac = function ShowLotsComponent_Factory(t) {\n    return new (t || ShowLotsComponent)(i0.ɵɵdirectiveInject(i1.ToastrService), i0.ɵɵdirectiveInject(i2.LotService), i0.ɵɵdirectiveInject(i3.FavoriteService), i0.ɵɵdirectiveInject(i4.AuthService));\n  };\n\n  ShowLotsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ShowLotsComponent,\n    selectors: [[\"app-show-lots\"]],\n    decls: 37,\n    vars: 9,\n    consts: [[\"rel\", \"stylesheet\", \"href\", \"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css\"], [1, \"sort\"], [\"mat-button\", \"\", 3, \"matMenuTriggerFor\"], [\"sortprice\", \"matMenu\"], [\"mat-menu-item\", \"\", 3, \"click\"], [\"sortdate\", \"matMenu\"], [\"sortyear\", \"matMenu\"], [1, \"lots\"], [3, \"diameter\", \"strokeWidth\", 4, \"ngIf\"], [4, \"ngFor\", \"ngForOf\"], [3, \"diameter\", \"strokeWidth\"], [\"class\", \"card\", 4, \"ngIf\"], [1, \"card\"], [1, \"timer\"], [3, \"id\"], [\"alt\", \"profile picture\", 3, \"src\"], [1, \"favorite\"], [1, \"unstar\", 3, \"id\", \"click\"], [1, \"main-block\"], [\"bold\", \"\"], [1, \"title\"], [3, \"routerLink\"]],\n    template: function ShowLotsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"link\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1)(2, \"button\", 2);\n        i0.ɵɵtext(3, \"Sort By Price\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"mat-menu\", null, 3)(6, \"button\", 4);\n        i0.ɵɵlistener(\"click\", function ShowLotsComponent_Template_button_click_6_listener() {\n          return ctx.sortingData(null, \"\");\n        });\n        i0.ɵɵtext(7, \"Remove filter\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"button\", 4);\n        i0.ɵɵlistener(\"click\", function ShowLotsComponent_Template_button_click_8_listener() {\n          return ctx.sortingData(ctx.SortViewMode.asc, \"currentPrice\");\n        });\n        i0.ɵɵtext(9, \"Ascending\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"button\", 4);\n        i0.ɵɵlistener(\"click\", function ShowLotsComponent_Template_button_click_10_listener() {\n          return ctx.sortingData(ctx.SortViewMode.desc, \"currentPrice\");\n        });\n        i0.ɵɵtext(11, \"Descending\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(12, \"button\", 2);\n        i0.ɵɵtext(13, \"Sort by Date\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"mat-menu\", null, 5)(16, \"button\", 4);\n        i0.ɵɵlistener(\"click\", function ShowLotsComponent_Template_button_click_16_listener() {\n          return ctx.sortingData(null, \"\");\n        });\n        i0.ɵɵtext(17, \"Remove filter\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"button\", 4);\n        i0.ɵɵlistener(\"click\", function ShowLotsComponent_Template_button_click_18_listener() {\n          return ctx.sortingData(ctx.SortViewMode.asc, \"startDateTime\");\n        });\n        i0.ɵɵtext(19, \"Ascending\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(20, \"button\", 4);\n        i0.ɵɵlistener(\"click\", function ShowLotsComponent_Template_button_click_20_listener() {\n          return ctx.sortingData(ctx.SortViewMode.desc, \"startDateTime\");\n        });\n        i0.ɵɵtext(21, \"Descending\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(22, \"button\", 2);\n        i0.ɵɵtext(23, \"Sort by Date\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"mat-menu\", null, 6)(26, \"button\", 4);\n        i0.ɵɵlistener(\"click\", function ShowLotsComponent_Template_button_click_26_listener() {\n          return ctx.sortingData(null, \"\");\n        });\n        i0.ɵɵtext(27, \"Remove filter\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(28, \"button\", 4);\n        i0.ɵɵlistener(\"click\", function ShowLotsComponent_Template_button_click_28_listener() {\n          return ctx.sortingData(ctx.SortViewMode.asc, \"year\");\n        });\n        i0.ɵɵtext(29, \"Ascending\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(30, \"button\", 4);\n        i0.ɵɵlistener(\"click\", function ShowLotsComponent_Template_button_click_30_listener() {\n          return ctx.sortingData(ctx.SortViewMode.desc, \"year\");\n        });\n        i0.ɵɵtext(31, \"Descending\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelement(32, \"hr\");\n        i0.ɵɵelementStart(33, \"div\", 7);\n        i0.ɵɵtemplate(34, ShowLotsComponent_app_mat_spinner_34_Template, 1, 2, \"app-mat-spinner\", 8);\n        i0.ɵɵtemplate(35, ShowLotsComponent_div_35_Template, 2, 1, \"div\", 9);\n        i0.ɵɵpipe(36, \"sort\");\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        const _r0 = i0.ɵɵreference(5);\n\n        const _r1 = i0.ɵɵreference(15);\n\n        const _r2 = i0.ɵɵreference(25);\n\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"matMenuTriggerFor\", _r0);\n        i0.ɵɵadvance(10);\n        i0.ɵɵproperty(\"matMenuTriggerFor\", _r1);\n        i0.ɵɵadvance(10);\n        i0.ɵɵproperty(\"matMenuTriggerFor\", _r2);\n        i0.ɵɵadvance(12);\n        i0.ɵɵproperty(\"ngIf\", !(ctx.lots == null ? null : ctx.lots.length));\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind3(36, 5, ctx.lots, ctx.sortMode, ctx.sortField));\n      }\n    },\n    dependencies: [i5.NgForOf, i5.NgIf, i6.RouterLink, i7.MatSpinnerComponent, i8.BoldDirective, i9.MatMenu, i9.MatMenuItem, i9.MatMenuTrigger, i5.CurrencyPipe, i10.SortPipe],\n    styles: [\"[_nghost-%COMP%]   *[_ngcontent-%COMP%]{box-sizing:border-box;outline:none}[_nghost-%COMP%]   .sort[_ngcontent-%COMP%]{width:60%;margin:0 auto}[_nghost-%COMP%]   hr[_ngcontent-%COMP%]{width:60%;border:none;background-color:#000;height:4px}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]{margin:0 20%;width:60%;justify-content:center;align-items:center}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{box-shadow:0 4px 8px #0003;max-width:300px;text-align:center;width:50%;float:left;border-radius:20px;height:350px;max-height:350px;overflow:hidden;margin:12px 15px}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:hover{transform:scale(1.05)}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;max-height:200px;min-height:200px}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .timer[_ngcontent-%COMP%]{background-color:#000;color:#fff;width:100%;opacity:.8;padding:3px}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .timer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{position:relative;margin:0 10px;height:auto;font-size:20px;align-items:center}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .favorite[_ngcontent-%COMP%]{padding-left:10px;position:absolute}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .favorite[_ngcontent-%COMP%]   .star[_ngcontent-%COMP%], [_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .favorite[_ngcontent-%COMP%]   .unstar[_ngcontent-%COMP%]{cursor:pointer;background:none;font-size:20px;float:left;transition:transform .2s;text-decoration:none;font-size:22px}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .favorite[_ngcontent-%COMP%]   .star[_ngcontent-%COMP%]{color:#ff0}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .favorite[_ngcontent-%COMP%]   .unstar[_ngcontent-%COMP%]{color:#fff}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .favorite[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{opacity:1;transform:scale(1.2)}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .main-block[_ngcontent-%COMP%]{padding:8px 4px 0;height:80px}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .main-block[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{line-height:10px;font-size:18px}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .main-block[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:15px;line-height:15px}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:12px;border:none;padding:6px;color:#fff;background-color:#000;text-align:center;cursor:pointer;width:100%;font-size:20px}[_nghost-%COMP%]   .lots[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{opacity:.7}[_nghost-%COMP%]     .mat-menu-trigger{font-size:16px;border:none;outline:none;color:#fff;padding:6px 16px;margin:0;border-radius:10px;background-color:#000;font-size:30px}.mat-focus-indicator.mat-menu-item[_ngcontent-%COMP%]{font-size:20px;width:max-content;min-width:150px}\"]\n  });\n  return ShowLotsComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}